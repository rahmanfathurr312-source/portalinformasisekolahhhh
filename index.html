<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Informasi Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-item {
            transition: all 0.2s ease-in-out;
        }
        .sidebar-item:hover, .sidebar-item.active {
            background-color: #1e40af; /* blue-800 */
            color: white;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 40;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-blue-900 text-white flex flex-col">
            <div class="p-6 text-center border-b border-blue-800">
                <h1 class="text-xl font-bold">Portal Sekolah</h1>
                <p id="school-name-sidebar" class="text-sm text-blue-300">SMA NEGERI 1 DRAMAGA</p>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" id="nav-beranda" class="sidebar-item active flex items-center p-3 rounded-lg">
                    <i class="fas fa-home w-6"></i><span>Beranda</span>
                </a>
                <a href="#" id="nav-profil" class="sidebar-item flex items-center p-3 rounded-lg">
                    <i class="fas fa-school w-6"></i><span>Profil Sekolah</span>
                </a>
                <a href="#" id="nav-jadwal" class="sidebar-item flex items-center p-3 rounded-lg">
                    <i class="fas fa-calendar-alt w-6"></i><span>Jadwal Pelajaran</span>
                </a>
                <a href="#" id="nav-pengumuman" class="sidebar-item flex items-center p-3 rounded-lg">
                    <i class="fas fa-bullhorn w-6"></i><span>Pengumuman</span>
                </a>
                <a href="#" id="nav-absensi" class="sidebar-item flex items-center p-3 rounded-lg">
                    <i class="fas fa-user-check w-6"></i><span>Absensi</span>
                </a>
                <a href="#" id="nav-siswa" class="sidebar-item flex items-center p-3 rounded-lg">
                    <i class="fas fa-users w-6"></i><span>Data Siswa</span>
                </a>
            </nav>
            <div class="p-4 border-t border-blue-800">
                <div id="user-info" class="text-center">
                    <!-- User Info akan diisi oleh JavaScript -->
                </div>
                <div class="mt-4 flex justify-center space-x-2">
                    <button id="switch-to-teacher" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg text-sm">Guru</button>
                    <button id="switch-to-parent" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg text-sm">Orang Tua</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto">
            <div id="content">
                <!-- Konten dinamis akan dimuat di sini -->
            </div>
        </main>
    </div>

    <!-- Modal untuk Tambah Pengumuman -->
    <div id="announcement-modal-backdrop" class="modal-backdrop"></div>
    <div id="announcement-modal" class="modal bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
        <div class="p-6 border-b">
            <h2 class="text-xl font-semibold">Tambah Pengumuman Baru</h2>
        </div>
        <div class="p-6">
            <form id="announcement-form">
                <div class="mb-4">
                    <label for="announcement-title" class="block text-sm font-medium text-gray-700">Judul</label>
                    <input type="text" id="announcement-title" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required>
                </div>
                <div>
                    <label for="announcement-content" class="block text-sm font-medium text-gray-700">Isi Pengumuman</label>
                    <textarea id="announcement-content" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></textarea>
                </div>
            </form>
        </div>
        <div class="px-6 py-4 bg-gray-50 text-right space-x-2">
            <button id="cancel-announcement" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">Batal</button>
            <button id="save-announcement" type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
        </div>
    </div>
    
    <!-- Modal untuk Edit Profil Sekolah -->
    <div id="profile-modal-backdrop" class="modal-backdrop"></div>
    <div id="profile-modal" class="modal bg-white rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3">
        <div class="p-6 border-b">
            <h2 class="text-xl font-semibold">Edit Profil Sekolah</h2>
        </div>
        <div class="p-6">
            <form id="profile-form">
                <div class="mb-4">
                    <label for="profile-name" class="block text-sm font-medium text-gray-700">Nama Sekolah</label>
                    <input type="text" id="profile-name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                <div class="mb-4">
                    <label for="profile-address" class="block text-sm font-medium text-gray-700">Alamat</label>
                    <input type="text" id="profile-address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" required>
                </div>
                <div class="mb-4">
                    <label for="profile-vision" class="block text-sm font-medium text-gray-700">Visi</label>
                    <textarea id="profile-vision" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                </div>
                <div>
                    <label for="profile-mission" class="block text-sm font-medium text-gray-700">Misi</label>
                    <textarea id="profile-mission" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea>
                </div>
            </form>
        </div>
        <div class="px-6 py-4 bg-gray-50 text-right space-x-2">
            <button id="cancel-profile" type="button" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">Batal</button>
            <button id="save-profile" type="button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
        </div>
    </div>


    <script>
        // --- Database Lokal (Pengganti Firebase) ---
        const localDB = {
            schoolProfile: {
                nama: "SMA NEGERI 1 DRAMAGA",
                alamat: "Jalan Raya Dramaga KM 07, Desa Dramaga, Kecamatan Dramaga, Kabupaten Bogor, Jawa Barat 16680",
                telepon: "0251-8621234",
                email: "info@sman1dramaga.sch.id",
                visi: "Terwujudnya sekolah yang unggul dalam prestasi, berkarakter, dan berwawasan lingkungan.",
                misi: "1. Melaksanakan pembelajaran dan bimbingan secara efektif...\n2. Mendorong dan membantu siswa untuk mengenali potensi dirinya...\n3. Menumbuhkan semangat keunggulan secara intensif..."
            },
            students: [
                { id: 'siswa01', nama: 'Ahmad Dahlan', kelas: 'Kelas 10A', ortu: 'Bapak Agus' },
                { id: 'siswa02', nama: 'Siti Aminah', kelas: 'Kelas 10A', ortu: 'Ibu Wati' },
                { id: 'siswa03', nama: 'Bambang Susilo', kelas: 'Kelas 10B', ortu: 'Bapak Joko' },
                { id: 'siswa04', nama: 'Dewi Lestari', kelas: 'Kelas 10B', ortu: 'Ibu Rina' },
                { id: 'siswa05', nama: 'Eko Prasetyo', kelas: 'Kelas 11C', ortu: 'Bapak Budi' },
                { id: 'siswa06', nama: 'Fitriani', kelas: 'Kelas 11C', ortu: 'Ibu Sri' },
                { id: 'siswa07', nama: 'Gunawan', kelas: 'Kelas 12L', ortu: 'Bapak Heru' },
                { id: 'siswa08', nama: 'Herlina', kelas: 'Kelas 12L', ortu: 'Ibu Endang' },
                { id: 'siswa09', nama: 'Indra Jaya', kelas: 'Kelas 11G', ortu: 'Bapak Surya' },
                { id: 'siswa10', nama: 'Joko Widodo', kelas: 'Kelas 12A', ortu: 'Bapak Noto' },
                { id: 'siswa11', nama: 'Kartini', kelas: 'Kelas 10L', ortu: 'Ibu Ngasirah' },
            ],
            teachers: [
                { nama: 'Drs. H. Abdullah, M.Pd.', mapel: 'Kepala Sekolah' },
                { nama: 'Dra. Sri Rahayu', mapel: 'Wakil Kepala Sekolah' },
                { nama: 'Budi Santoso, S.Pd.', mapel: 'Matematika' },
                { nama: 'Siti Aminah, S.S.', mapel: 'Bahasa Indonesia' },
                { nama: 'Dr. Iwan Setiawan, M.Si.', mapel: 'Fisika & Kimia' },
                { nama: 'Dewi Lestari, S.Hum.', mapel: 'Bahasa Inggris' },
                { nama: 'Agus Purnomo, S.E.', mapel: 'Ekonomi' },
                { nama: 'Rina Maryati, S.Ag.', mapel: 'Pendidikan Agama' },
            ],
            announcements: [
                {
                    judul: "Selamat Datang di Portal SMAN 1 Dramaga",
                    isi: "Ini adalah portal informasi baru untuk SMAN 1 Dramaga. Semua informasi penting akan diperbarui di sini.",
                    tanggal: new Date()
                }
            ],
            attendance: {
                // Key adalah tanggal YYYY-MM-DD
                [new Date().toISOString().slice(0, 10)]: {
                    'siswa01': 'Hadir', 'siswa02': 'Hadir', 'siswa03': 'Sakit', 'siswa04': 'Hadir',
                    'siswa05': 'Izin', 'siswa06': 'Hadir', 'siswa07': 'Alfa', 'siswa08': 'Hadir',
                    'siswa09': 'Hadir', 'siswa10': 'Sakit', 'siswa11': 'Hadir',
                }
            }
        };

        // --- State Aplikasi ---
        let currentUser = null; 
        let currentView = 'beranda';

        // --- Data Dummy & Pengguna Simulasi ---
        function generateClassList() {
            const grades = [10, 11, 12];
            const letters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'];
            const classList = [];
            grades.forEach(grade => {
                letters.forEach(letter => {
                    classList.push(`Kelas ${grade}${letter}`);
                });
            });
            return classList;
        }

        const teacherUser = {
            uid: 'guru01',
            nama: 'Ibu Budiarti',
            role: 'teacher',
            kelasWali: generateClassList()
        };
        const parentUser = {
            uid: 'ortu01',
            nama: 'Bapak Agus',
            role: 'parent',
            childId: 'siswa01'
        };

        // --- Fungsi Utama ---
        function initializeAppLogic() {
            switchUser('teacher');
        }

        // --- Fungsi Render Konten ---
        function renderContent(view) {
            const content = document.getElementById('content');
            content.innerHTML = '<div class="text-center p-10"><i class="fas fa-spinner fa-spin fa-3x"></i></div>';
            
            // Simulasikan loading
            setTimeout(() => {
                switch (view) {
                    case 'beranda': renderBeranda(content); break;
                    case 'profil': renderProfil(content); break;
                    case 'jadwal': renderJadwal(content); break;
                    case 'pengumuman': renderPengumuman(content); break;
                    case 'absensi': renderAbsensi(content); break;
                    case 'siswa': renderSiswa(content); break;
                }
                updateActiveNav(view);
            }, 200);
        }

        function renderBeranda(container) {
            const profileData = localDB.schoolProfile;
            document.getElementById('school-name-sidebar').textContent = profileData.nama;

            container.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Selamat Datang di Portal ${profileData.nama}</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-xl font-semibold mb-3"><i class="fas fa-school mr-2 text-blue-600"></i>Profil Singkat</h2>
                        <p><strong>Alamat:</strong> ${profileData.alamat}</p>
                        <p><strong>Email:</strong> ${profileData.email}</p>
                        <p><strong>Telepon:</strong> ${profileData.telepon}</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h2 class="text-xl font-semibold mb-3"><i class="fas fa-bullhorn mr-2 text-yellow-500"></i>Pengumuman Terbaru</h2>
                        <div id="latest-announcements"></div>
                    </div>
                </div>
            `;
            
            const announcementsDiv = document.getElementById('latest-announcements');
            let announcementsHTML = '<ul class="space-y-2">';
            // Mengambil 3 pengumuman terbaru
            [...localDB.announcements].reverse().slice(0, 3).forEach(data => {
                announcementsHTML += `<li class="border-b pb-2"><strong>${data.judul}</strong><p class="text-sm text-gray-600">${data.isi.substring(0, 50)}...</p></li>`;
            });
            announcementsHTML += '</ul>';
            announcementsDiv.innerHTML = announcementsHTML;
        }

        function renderProfil(container) {
            const data = localDB.schoolProfile;
            container.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Profil Sekolah</h1>
                <div class="bg-white p-8 rounded-lg shadow">
                    ${currentUser && currentUser.role === 'teacher' ? '<button id="edit-profile-btn" class="float-right bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"><i class="fas fa-edit mr-2"></i>Edit Profil</button>' : ''}
                    <h2 class="text-2xl font-semibold text-blue-800">${data.nama}</h2>
                    <p class="text-gray-600 mt-2"><i class="fas fa-map-marker-alt mr-2"></i>${data.alamat}</p>
                    <hr class="my-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-2">Visi</h3>
                        <p class="text-gray-700 whitespace-pre-line">${data.visi}</p>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-xl font-semibold mb-2">Misi</h3>
                        <p class="text-gray-700 whitespace-pre-line">${data.misi}</p>
                    </div>
                        <hr class="my-6">
                    <div class="mt-6">
                        <h3 class="text-xl font-semibold mb-4">Staf Pengajar Unggulan</h3>
                        <div id="teacher-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${localDB.teachers.map(teacher => `
                                <div class="bg-gray-100 p-4 rounded-lg">
                                    <p class="font-semibold text-gray-800">${teacher.nama}</p>
                                    <p class="text-sm text-gray-600">${teacher.mapel}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
            if (currentUser && currentUser.role === 'teacher') {
                document.getElementById('edit-profile-btn').addEventListener('click', openProfileModal);
            }
        }

        function renderJadwal(container) {
            const jadwal_10a = {
                'Senin': [
                    { jam: '07:00 - 07:30', pelajaran: 'Upacara Bendera' }, { jam: '07:30 - 09:00', pelajaran: 'Matematika Wajib' }, { jam: '09:00 - 10:30', pelajaran: 'Fisika' }, { jam: '10:30 - 11:00', pelajaran: 'Istirahat' }, { jam: '11:00 - 12:30', pelajaran: 'Bahasa Indonesia' }, { jam: '12:30 - 13:15', pelajaran: 'Istirahat Siang & Sholat' }, { jam: '13:15 - 14:45', pelajaran: 'Sejarah Indonesia' }
                ],
                'Selasa': [
                    { jam: '07:00 - 08:30', pelajaran: 'Bahasa Inggris' }, { jam: '08:30 - 10:00', pelajaran: 'Kimia' }, { jam: '10:00 - 10:30', pelajaran: 'Istirahat' }, { jam: '10:30 - 12:00', pelajaran: 'PPKn' }, { jam: '12:00 - 12:45', pelajaran: 'Istirahat Siang & Sholat' }, { jam: '12:45 - 14:15', pelajaran: 'PJOK' }
                ],
                'Rabu': [
                    { jam: '07:00 - 08:30', pelajaran: 'Biologi' }, { jam: '08:30 - 10:00', pelajaran: 'Bahasa Indonesia' }, { jam: '10:00 - 10:30', pelajaran: 'Istirahat' }, { jam: '10:30 - 12:00', pelajaran: 'Geografi' }, { jam: '12:00 - 12:45', pelajaran: 'Istirahat Siang & Sholat' }, { jam: '12:45 - 14:15', pelajaran: 'Pendidikan Agama' }
                ],
                'Kamis': [
                    { jam: '07:00 - 08:30', pelajaran: 'Matematika Peminatan' }, { jam: '08:30 - 10:00', pelajaran: 'Seni Budaya' }, { jam: '10:00 - 10:30', pelajaran: 'Istirahat' }, { jam: '10:30 - 12:00', pelajaran: 'Bahasa Inggris' }, { jam: '12:00 - 12:45', pelajaran: 'Istirahat Siang & Sholat' }, { jam: '12:45 - 14:15', pelajaran: 'TIK' }
                ],
                'Jumat': [
                    { jam: '07:00 - 09:00', pelajaran: 'Kegiatan Rohani / Literasi' }, { jam: '09:00 - 09:15', pelajaran: 'Istirahat' }, { jam: '09:15 - 11:15', pelajaran: 'Ekonomi' }, { jam: '11:15 - 13:00', pelajaran: 'Istirahat Panjang & Sholat Jumat' }, { jam: '13:00 - 14:30', pelajaran: 'Sosiologi' }
                ]
            };
            
            let html = `<h1 class="text-3xl font-bold text-gray-800 mb-6">Jadwal Pelajaran</h1>`;
            html += '<p class="mb-4 text-gray-600">Berikut adalah jadwal untuk Kelas 10A.</p>';
            html += '<div class="space-y-6">';
            Object.keys(jadwal_10a).forEach(hari => {
                html += `<div class="bg-white p-6 rounded-lg shadow"><h2 class="text-xl font-semibold mb-4 text-blue-700">${hari}</h2><table class="w-full"><tbody>`;
                jadwal_10a[hari].forEach(item => {
                    const isIstirahat = item.pelajaran.toLowerCase().includes('istirahat');
                    html += `<tr class="border-b last:border-b-0"><td class="py-3 px-2 w-1/3 text-gray-500">${item.jam}</td><td class="py-3 px-2 font-medium ${isIstirahat ? 'text-green-600' : 'text-gray-800'}">${item.pelajaran}</td></tr>`;
                });
                html += `</tbody></table></div>`;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function renderPengumuman(container) {
            container.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold text-gray-800">Pengumuman</h1>
                    ${currentUser && currentUser.role === 'teacher' ? '<button id="add-announcement-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg"><i class="fas fa-plus mr-2"></i>Buat Baru</button>' : ''}
                </div>
                <div id="announcement-list" class="space-y-4"></div>
            `;
            
            if (currentUser && currentUser.role === 'teacher') {
                document.getElementById('add-announcement-btn').addEventListener('click', openAnnouncementModal);
            }

            const list = document.getElementById('announcement-list');
            list.innerHTML = '';
            [...localDB.announcements].reverse().forEach(data => {
                const date = data.tanggal.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                const card = document.createElement('div');
                card.className = 'bg-white p-6 rounded-lg shadow';
                card.innerHTML = `
                    <h2 class="text-xl font-semibold text-blue-800">${data.judul}</h2>
                    <p class="text-sm text-gray-500 mb-3">${date}</p>
                    <p class="text-gray-700 whitespace-pre-line">${data.isi}</p>
                `;
                list.appendChild(card);
            });
        }

        function renderAbsensi(container) {
            const today = new Date().toISOString().slice(0, 10);
            container.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Absensi Siswa - ${new Date().toLocaleDateString('id-ID', { dateStyle: 'full' })}</h1>
                <div id="attendance-view"></div>
            `;

            if (currentUser && currentUser.role === 'teacher') {
                const attendanceView = document.getElementById('attendance-view');
                let classOptions = '';
                currentUser.kelasWali.forEach(kelas => {
                    classOptions += `<option value="${kelas}">${kelas}</option>`;
                });

                attendanceView.innerHTML = `
                    <div class="mb-4">
                        <label for="class-filter" class="block text-sm font-medium text-gray-700">Pilih Kelas:</label>
                        <select id="class-filter" class="mt-1 block w-full md:w-1/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            ${classOptions}
                        </select>
                    </div>
                    <div id="attendance-content" class="bg-white p-6 rounded-lg shadow"></div>
                `;

                const classFilter = document.getElementById('class-filter');
                classFilter.addEventListener('change', (e) => {
                    renderTeacherAttendance(today, e.target.value);
                });
                
                renderTeacherAttendance(today, currentUser.kelasWali[0]);

            } else {
                renderParentAttendance(today);
            }
        }

        function renderTeacherAttendance(date, className) {
            const contentDiv = document.getElementById('attendance-content');
            if (!contentDiv) return;
            
            const attendanceData = localDB.attendance[date] || {};
            const studentsInClass = localDB.students.filter(s => s.kelas === className);
            
            let html = '<table class="w-full"><thead><tr class="text-left"><th class="p-3">Nama Siswa</th><th class="p-3">Status</th></tr></thead><tbody>';
            if (studentsInClass.length === 0) {
                html += '<tr><td colspan="2" class="text-center p-4 text-gray-500">Tidak ada siswa di kelas ini.</td></tr>';
            } else {
                studentsInClass.forEach(student => {
                    const status = attendanceData[student.id] || 'Belum Diabsen';
                    html += `
                        <tr class="border-t">
                            <td class="p-3">${student.nama}</td>
                            <td class="p-3">
                                <select data-studentid="${student.id}" data-studentname="${student.nama}" class="attendance-select rounded-md border-gray-300">
                                    <option value="Hadir" ${status === 'Hadir' ? 'selected' : ''}>Hadir</option>
                                    <option value="Izin" ${status === 'Izin' ? 'selected' : ''}>Izin</option>
                                    <option value="Sakit" ${status === 'Sakit' ? 'selected' : ''}>Sakit</option>
                                    <option value="Alfa" ${status === 'Alfa' ? 'selected' : ''}>Alfa</option>
                                </select>
                            </td>
                        </tr>
                    `;
                });
            }
            html += '</tbody></table>';
            contentDiv.innerHTML = html;

            document.querySelectorAll('.attendance-select').forEach(select => {
                select.addEventListener('change', (e) => {
                    const studentId = e.target.dataset.studentid;
                    const studentName = e.target.dataset.studentname;
                    const newStatus = e.target.value;
                    
                    if (!localDB.attendance[date]) {
                        localDB.attendance[date] = {};
                    }
                    localDB.attendance[date][studentId] = newStatus;
                    
                    const notification = document.createElement('div');
                    notification.textContent = `Absensi ${studentName} diperbarui (data lokal).`;
                    notification.className = 'fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg';
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 2000);
                });
            });
        }

        function renderParentAttendance(date) {
            const contentDiv = document.getElementById('attendance-view');
            if (!currentUser || !currentUser.childId) {
                contentDiv.innerHTML = '<div class="bg-white p-6 rounded-lg shadow"><p>Data anak tidak ditemukan untuk akun ini.</p></div>';
                return;
            }
            const childId = currentUser.childId;
            const studentData = localDB.students.find(s => s.id === childId);
            const attendanceData = localDB.attendance[date] || {};
            const status = attendanceData[childId] || 'Belum ada data';
            
            let statusClass = '';
            switch(status) {
                case 'Hadir': statusClass = 'bg-green-100 text-green-800'; break;
                case 'Izin': statusClass = 'bg-blue-100 text-blue-800'; break;
                case 'Sakit': statusClass = 'bg-yellow-100 text-yellow-800'; break;
                case 'Alfa': statusClass = 'bg-red-100 text-red-800'; break;
                default: statusClass = 'bg-gray-100 text-gray-800';
            }

            contentDiv.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow">
                    <p class="text-lg">Status kehadiran untuk <strong>${studentData.nama}</strong>:</p>
                    <div class="mt-4 text-2xl font-bold p-4 rounded-lg text-center ${statusClass}">
                        ${status}
                    </div>
                </div>
            `;
        }

        function renderSiswa(container) {
             container.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Data Siswa</h1>
                <div id="student-list-container" class="bg-white p-6 rounded-lg shadow"></div>
            `;
            if(currentUser && currentUser.role === 'teacher') {
                renderAllStudents();
            } else {
                renderChildData();
            }
        }

        function renderAllStudents() {
            const listContainer = document.getElementById('student-list-container');
            let html = '<table class="w-full"><thead><tr class="text-left"><th class="p-3">Nama</th><th class="p-3">Kelas</th><th class="p-3">Orang Tua</th></tr></thead><tbody>';
            localDB.students.forEach(student => {
                html += `<tr class="border-t hover:bg-gray-50"><td class="p-3">${student.nama}</td><td class="p-3">${student.kelas}</td><td class="p-3">${student.ortu}</td></tr>`;
            });
            html += '</tbody></table>';
            listContainer.innerHTML = html;
        }

        function renderChildData() {
            const listContainer = document.getElementById('student-list-container');
            if (!currentUser || !currentUser.childId) {
                listContainer.innerHTML = `<p>Data anak tidak ditemukan untuk akun ini.</p>`;
                return;
            }
            const childId = currentUser.childId;
            const student = localDB.students.find(s => s.id === childId);
            listContainer.innerHTML = `
                <h2 class="text-xl font-semibold mb-4">Profil Anak Anda</h2>
                <div class="space-y-3">
                    <p><strong>Nama:</strong> ${student.nama}</p>
                    <p><strong>Kelas:</strong> ${student.kelas}</p>
                    <p><strong>Wali Murid:</strong> ${student.ortu}</p>
                </div>
            `;
        }

        // --- Fungsi Helper & Event Listener ---
        function updateActiveNav(view) {
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
            });
            document.getElementById(`nav-${view}`).classList.add('active');
        }

        function switchUser(role) {
            currentUser = (role === 'teacher') ? teacherUser : parentUser;
            const userInfoDiv = document.getElementById('user-info');
            userInfoDiv.innerHTML = `
                <p class="font-semibold">${currentUser.nama}</p>
                <p class="text-sm text-blue-300 capitalize">${currentUser.role}</p>
            `;
            
            const teacherBtn = document.getElementById('switch-to-teacher');
            const parentBtn = document.getElementById('switch-to-parent');
            if (role === 'teacher') {
                teacherBtn.classList.add('ring-2', 'ring-offset-2', 'ring-offset-blue-900', 'ring-white');
                parentBtn.classList.remove('ring-2', 'ring-offset-2', 'ring-offset-blue-900', 'ring-white');
            } else {
                parentBtn.classList.add('ring-2', 'ring-offset-2', 'ring-offset-blue-900', 'ring-white');
                teacherBtn.classList.remove('ring-2', 'ring-offset-2', 'ring-offset-blue-900', 'ring-white');
            }

            renderContent(currentView);
        }
        
        // --- Modal Logic ---
        const announcementModal = document.getElementById('announcement-modal');
        const announcementBackdrop = document.getElementById('announcement-modal-backdrop');
        const profileModal = document.getElementById('profile-modal');
        const profileBackdrop = document.getElementById('profile-modal-backdrop');

        function openAnnouncementModal() {
            announcementModal.style.display = 'block';
            announcementBackdrop.style.display = 'block';
        }
        function closeAnnouncementModal() {
            document.getElementById('announcement-form').reset();
            announcementModal.style.display = 'none';
            announcementBackdrop.style.display = 'none';
        }
        
        function openProfileModal() {
            const data = localDB.schoolProfile;
            document.getElementById('profile-name').value = data.nama;
            document.getElementById('profile-address').value = data.alamat;
            document.getElementById('profile-vision').value = data.visi;
            document.getElementById('profile-mission').value = data.misi;

            profileModal.style.display = 'block';
            profileBackdrop.style.display = 'block';
        }
        function closeProfileModal() {
            document.getElementById('profile-form').reset();
            profileModal.style.display = 'none';
            profileBackdrop.style.display = 'none';
        }

        // --- Event Listeners ---
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                currentView = item.id.replace('nav-', '');
                renderContent(currentView);
            });
        });

        document.getElementById('switch-to-teacher').addEventListener('click', () => switchUser('teacher'));
        document.getElementById('switch-to-parent').addEventListener('click', () => switchUser('parent'));
        
        // Announcement Modal Listeners
        document.getElementById('save-announcement').addEventListener('click', () => {
            const title = document.getElementById('announcement-title').value;
            const content = document.getElementById('announcement-content').value;
            if (title && content) {
                localDB.announcements.push({
                    judul: title,
                    isi: content,
                    tanggal: new Date()
                });
                closeAnnouncementModal();
                renderContent('pengumuman'); // Re-render halaman pengumuman
            }
        });
        document.getElementById('cancel-announcement').addEventListener('click', closeAnnouncementModal);
        announcementBackdrop.addEventListener('click', closeAnnouncementModal);
        
        // Profile Modal Listeners
        document.getElementById('save-profile').addEventListener('click', () => {
             localDB.schoolProfile.nama = document.getElementById('profile-name').value;
             localDB.schoolProfile.alamat = document.getElementById('profile-address').value;
             localDB.schoolProfile.visi = document.getElementById('profile-vision').value;
             localDB.schoolProfile.misi = document.getElementById('profile-mission').value;
             closeProfileModal();
             renderContent('profil'); // Re-render halaman profil
        });
        document.getElementById('cancel-profile').addEventListener('click', closeProfileModal);
        profileBackdrop.addEventListener('click', closeProfileModal);


        // Inisialisasi aplikasi saat DOM siap
        document.addEventListener('DOMContentLoaded', initializeAppLogic);

    </script>
</body>
</html>
